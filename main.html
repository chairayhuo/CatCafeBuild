<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>CAT CAFE DEMO</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type=module>


import zim from "https://zimjs.com/cdn/015/zim_game";

const assets = ["BabyDoll.ttf", "blackcat.png", "orangecat.png", "whitecat.png","tuxcat.png","milkdemo.png", "0.png","1.png", "2.png","3.png", "4.png", "5.png", "winning.png"];
const path = "assets/"

// See Docs under Frame for FIT, FILL, FULL, and TAG
new Frame(FIT, 1024, 768, light, dark, ready, assets, path);
function ready() {




//OPENING -----------------------------------------------------------------------
let title;
let titleanimate;
let rules;
let rules2;

part1();
function part1 (){
    STYLE = {
        font: "BabyDoll.ttf"
    }

    title = new Container(W,H).center();

    new Pic("title.png").addTo(title).center().bot();

    titleanimate = new Pic("titleanimate.png").addTo(title).center().animate({
        props:{y:10},
        loop:true,
        rewind:true
    });

    const play = new Button({
        width:120, 
        height:60,
        label: "PLAY",
        backgroundColor:"#A44B43",

    })  
        .pos(0, 50, CENTER, CENTER, title)
        .hov()
        .top()
        .tap(part2);
        
    play.on("click", ()=>{   
        new Aud("backing.mp3").play({volume:.1, loop:true});
    }, null, true);


    S.update();
};//end part1

function part2 () {
   rules = new Container(W,H).center();
   new Pic("rules.png").addTo(rules).center().bot().alp(0).animate({alpha: 1}, 1);

   rules.on("click",()=>{
    const next = new Button({
        width:120, 
        height:60,
        label: "next",
        backgroundColor:"#A44B43",
       }).pos(100, 100, RIGHT, BOTTOM, rules).tap(part3);
   });
        S.update();


};//end part2

function part3 () {
    STYLE = {
        font: "BabyDoll.ttf"
    }
    rules2 = new Container(W,H).center();
   new Pic("rules2.png").addTo(rules2).center().bot().alp(0).animate({alpha: 1}, 1);

   rules2.on("click",()=>{
    const begin = new Button({
        width:120, 
        height:60,
        label: "next",
        backgroundColor:"#A44B43",
       }).pos(100, 100, RIGHT, BOTTOM, rules2).tap(part4);
      
   });


   S.update();
};//end part3


//BACKGROUND ELEMENTS-------------------------------------------------------------
function part4 () {
title.removeFrom();
titleanimate.removeFrom()
rules.removeFrom();
rules2.removeFrom();
let finalScore;

S.update();
//remove all previous containers

const background = new Pic("background.png").sca(.85).center();
S.update();

let score = new Scorer({
    font:"BabyDoll.ttf",
    backgroundColor:orange,
    borderColor: black,
    borderWidth:3,
    width:60}).pos(50,50,RIGHT);

const timer = new Timer({
    font:"BabyDoll.ttf",
    backgroundColor:yellow,
    borderColor: black,
    borderWidth:3,
    width:60}).pos(50,50);
    background.on("mousedown", ()=>{              
    timer.start();    
    }, null, true); 

S.update();
//AUDIO---------------------------------------------------------------------------

const flip = new Aud({
        file:"flip.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const close = new Aud({
        file:"close.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const pickup = new Aud({
        file:"pickup.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const meow = new Aud({
        file:"meow.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const angry = new Aud({
        file:"angry.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});


//CATBIBLE------------------------------------------------------------------------
let closeBook;

const page1 = new Page({color: "#EFE2CF"});
page1.content = new Pic("0.png").addTo(page1).pos(-10,0,CENTER,LEFT,page1);

const page2 = new Page({color: "#EFE2CF"});
page2.content = new Pic("1.png").addTo(page2).pos(340,0,CENTER,RIGHT, page1);

const page3 = new Page({color: "#EFE2CF"});
page3.content = new Pic("2.png").addTo(page3).pos(-10,0,CENTER,LEFT,page3);

const page4 = new Page({color: "#EFE2CF"});
page4.content = new Pic("3.png").addTo(page4).pos(340,0,CENTER,RIGHT, page3);

const page5 = new Page({color: "#EFE2CF"});
page5.content = new Pic("4.png").addTo(page5).pos(-10,0,CENTER,LEFT,page5);

const page6 = new Page({color: "#EFE2CF"});
page6.content = new Pic("5.png").addTo(page6).pos(340,0,CENTER,RIGHT, page5);

const pages = [page1, page2, page3, page4, page5];

const book = new Book(700, 500, pages)

const bookCont = new Container(70,70).pos(150,50,RIGHT, TOP);
const catbible = new Pic("catbible.png").addTo(bookCont).scaleTo(bookCont).hov(1)   
    .tap(()=>{
        flip.play();
        book.center().addTo(S);
        closeBook = new Button(40,38,"x",red).pos(170,145, RIGHT, TOP);
        closeBook.tap(()=>{
            if (S.contains(book)) {
                close.play()
                book.removeFrom(S);
                closeBook.removeFrom()
            }
        });
    });


//CATS INITIALIZATION------------------------------------------------------------------
    let orangecat = new Pic ("orangecat.png").sca(0.5);
    let whitecat = new Pic ("whitecat.png").sca(0.5);
    let blackcat = new Pic ("blackcat.png").sca(0.5);
    let tuxcat = new Pic ("tuxcat.png").sca(0.5);


//CAT TIMER-----------------------------------------------------------------------------
// STYLE = {
//    type:{Timer:{font:"BabyDoll.ttf",backgroundColor:white,borderColor: black,borderWidth:3,width:60},}
//    }

    // let blackTimer = new Timer({
    //     time: 15,
    //     font:"BabyDoll.ttf",
    //     backgroundColor:white,
    //     borderColor: black,
    //     borderWidth:3,
    //     width:60}).addTo(blackcat).pos(130,15);

    // let orangeTimer = new Timer({
    //     time: 15,
    //     font:"BabyDoll.ttf",
    //     backgroundColor:white,
    //     borderColor: black,
    //     borderWidth:3,
    //     width:60}).addTo(orangecat).pos(135,-10);

    // let whiteTimer = new Timer({
    //     time: 12,
    //     font:"BabyDoll.ttf",
    //     backgroundColor:white,
    //     borderColor: black,
    //     borderWidth:3,
    //     width:60}).addTo(whitecat).pos(135,10);

    // let tuxTimer = new Timer({
    //     time: 10,
    //     font:"BabyDoll.ttf",
    //     backgroundColor:white,
    //     borderColor: black,
    //     borderWidth:3,
    //     width:60}).addTo(tuxcat).pos(135,5);

    //     let catTimers = [blackTimer, orangeTimer, whiteTimer,tuxTimer];

//ITEMS TO CAT---------------------------------------------------------------------

    let milk;
    let food;
    let brush;
    let catnip
    let toy;

    const item1 = new Container(80, 80).loc(103, 578);
    const item2 = new Container(80, 80).loc(306, 608);
    const item3 = new Container(80, 80).loc(797, 624);
    const item4 = new Container(80, 80).loc(462, 606);
    const item5 = new Container(80, 80).loc(662, 602);

    loop(30, () => {
        milk = new Pic("milkdemo.png").addTo(item1).scaleTo(item1).drag().top();
        food = new Pic("fooddemo.png").addTo(item2).scaleTo(item2).drag().top();
        brush = new Pic("brushdemo.png").addTo(item3).scaleTo(item3).drag().top();
        catnip = new Pic("catnipdemo.png").addTo(item4).scaleTo(item4).drag().top();
        toy = new Pic("toydemo.png").addTo(item5).scaleTo(item5).drag().top();

        [milk, food, brush, catnip, toy].forEach(item => {
            item.startScale = { scaleX: item.scaleX, scaleY: item.scaleY }; 
            item.startPos = { x: item.x, y: item.y }; 
            item.on("pressup", () => checkItem(item));
            pickup.play();
        });
    });
            

//     function checkItem(item) {
//         cats.forEach((catInfo, index) => {
//             if (item.hitTestBounds(catInfo.cat)) {
//                 if (item && typeof item === 'string' && catInfo.accepting.includes(item)) {
//                     // Remove the item from the accepting array
//                     catInfo.accepting = catInfo.accepting.filter(i => i !== item);

//                     // Increase satisfaction
//                     catInfo.satisfaction++;
//                     zog(`Increased satisfaction of ${catInfo.cat} to ${catInfo.satisfaction}`);


      
//                     if (catInfo.satisfaction === 3) {
//                         catInfo.cat.dispatchEvent("satisfied");
//                         catInfo.accepting = [...initialItems[index]];
//                         catInfo.catTimers.dispose();
//                         animateCatOffScreen(catInfo.cat);
//                         score.score++;
//                         finalScore = score.score;
//                          zog(finalScore);
//                         zog(score.score);
//                     }
//                     item.dispose();
//                 } else {
//                     // If the cat is not accepting the item, snap it back to the start position
//                     item.animate({ x: item.startPos.x, y: item.startPos.y }, 0.3);
//                 }
//             } else {
//                 // If the item is not hitting any cat, snap it back to the start position
//                 item.animate({ x: item.startPos.x, y: item.startPos.y }, 0.3);
//             }
//         });
//     };


// setInterval(() => {
//     cats.forEach(catInfo => {
//         catInfo.accepting = 3; 
//     });
// }, 5); 

//ADD RANDOM CATS-----------------------------------------------------------------------------

let spotA = new Container(150, 150).loc(300,390).outline().reg(CENTER);
let spotB = new Container(150, 150).loc(70,390).outline().reg(CENTER);
let spotC = new Container(150, 150).loc(550,390).outline().reg(CENTER);
let spotD = new Container(150, 150).loc(870,310).outline().reg(CENTER);
let spots = [spotA, spotB, spotC, spotD];


let activeTimers = []; 
function placeRandomCat(spot) {
    STYLE = {
   type:{Timer:{font:"BabyDoll.ttf",backgroundColor:white,borderColor: black,borderWidth:3,width:60},}
   }

   let cats = [
    { pic: "blackcat.png", accepting: [milk, food, brush], time: 15 },
    { pic: "orangecat.png", accepting: [milk, food, brush], time: 15 },
    { pic: "whitecat.png", accepting: [milk, food, brush], time: 12 },
    { pic: "tuxcat.png", accepting: [milk, food, brush], time: 10 }
    ];

    // function animateCatMad() {
    //     angry.play();
    //     randomCatPic.animate({
    //         props:{x:-500, y:50}, 
    //         time: 5, 
    //         ease:"backOut",
    //     })
    // }  

    if (spot.children.length === 0) {
        let randomCatData = pluck(cats);
        let randomCatPic = new Pic(randomCatData.pic);
        let randomCatTimer = new Timer({
            ...STYLE.type.Timer, time: randomCatData.time
        }).center();

        randomCatPic.addTo(spot).scaleTo(spot);
        randomCatTimer.addTo(spot);
        randomCatTimer.pos(randomCatPic.x + 60, randomCatPic.y + randomCatPic.height);

        activeTimers.push(randomCatTimer); // Add this timer to the list of active timers

        setTimeout(() => {
            angry.play();
            randomCatPic.animate({
            props:{x:-1000, y:50}, 
            time: 5, 
            ease:"backOut",
        })
                randomCatTimer.removeFrom(spot);
                activeTimers.splice(activeTimers.indexOf(randomCatTimer), 1); // Remove this timer from active timers
            setTimeout(() => {
                // Remove the cat and timer after the animation
                randomCatPic.removeFrom(spot);
                // randomCatTimer.removeFrom(spot);
                // activeTimers.splice(activeTimers.indexOf(randomCatTimer), 1); // Remove this timer from active timers
                placeRandomCat(spot); // Place a new cat
            }, 1500); // Wait for the animation to finish (5 seconds)
        }, randomCatData.time * 1100);
    } else {
        setTimeout(() => placeRandomCat(spot), 3000); // Check again after 3 seconds
    }
}

function updateTimer() {
    activeTimers.forEach(timer => {
        if (timer.time <= 3) {
            timer.backgroundColor = "red";
        } else if (timer.time <= 7) {
            timer.backgroundColor = "orange";
        } else {
            timer.backgroundColor = "white";
        }
    });
}

Ticker.add(updateTimer, 1); // Update all timers every tick

function pluck(array) {
    return array[Math.floor(Math.random() * array.length)];
}

// Start the process
spots.forEach(spot => placeRandomCat(spot));


//CAT REACTIONS--------------------------------------------------------------------
// function updateTimer() {
//     for (let i = 0; i < catTimers.length; i++) {
//         let timer = catTimers[i];
//         if (timer.time <= 3) {
//             timer.backgroundColor = "red";
//         } else if (timer.time <= 7) {
//             timer.backgroundColor = "orange";
//         } else {
//             timer.backgroundColor = white;
//         }
//         if (timer.time <= 0) {
//             const currentCat = cats[i];
//             animateCatMad(currentCat.cat, () => {
//                 if (currentCat.spot) {
//                     currentCat.spot.removeAllChildren();
//                     currentCat.spot.occupied = false; // Update spot status
//                 }
//                 timer.dispose();
//             });
//         }
//     }
// }

// Ticker.add(updateTimer, 1);

//HAPPY CAT
function animateCatOffScreen() {
        meow.play();
        randomCatPic.animate([
            { props: { y: cat.y - 20 }, time: 0.5, ease: "bounceIn" },
            { props: { y: cat.y + 20 }, time: 0.7, ease: "bounceOut" },
            { props: { x: -500, y: 50 }, time: 5, ease: "backOut" }
            ])
    };




//MAD CAT
// function animateCatMad() {
//         angry.play();
//         randomCatPic.animate({
//             props:{x:-500, y:50}, 
//             time: 5, 
//             ease:"backOut",
//         })
//     }        



S.update();

//WINNING SCREEN --------------------------------------------------------------------------------------------

timer.on("complete", () => {
        zog(finalScore);
        const savedFinalScore = finalScore; 
        setTimeout(() => {
        S.removeAllChildren();
        S.update();
        displayWinningComment(savedFinalScore);
        winningPage(savedFinalScore);
        }, 2); 
        });

    const winningComments = {
        0: "Looks like you've got a bit of a 'cat-astrophe' on your hands! Remember, practice makes 'purr-fect'!",
        1: "You're just starting to 'paw' your way to success! Keep going and you'll be the cat's meow in no time!",
        6: "You're getting your 'claws' into it! Keep up the good work and you'll be a 'purr'-fessional soon!",
        11: "Look at you, a 'whisker' away from being a top cat carer! Keep those treats coming!",
        16: "You're the cat's 'whiskers'! Just a little more and you'll be the ultimate cat companion!",
        21: "You're the 'purr-fect' cat caretaker! All the kitties are 'feline' good thanks to your expert care!",
        26: "You're a legendary cat whisperer! Even the most finicky felines find you 'paw-some'!"
    };

    let comment = "";

    function displayWinningComment(score) {
        
        if (score === 0) {
            comment = winningComments[0];
        } else if (score >= 1 && score <= 5) {
            comment = winningComments[1];
        } else if (score >= 6 && score <= 10) {
            comment = winningComments[6];
        } else if (score >= 11 && score <= 15) {
            comment = winningComments[11];
        } else if (score >= 16 && score <= 20) {
            comment = winningComments[16];
        } else if (score >= 21 && score <= 25) {
            comment = winningComments[21];
        } else if (score > 25) {
            comment = winningComments[26];
        }
        zog(comment);
    }


        function winningPage(score){

        const winning = new Pic("winning.png").center().alp(0).animate({alpha: 1}, 1);

        const finalScore = new Label({
            text:"Your final score is",
            size:60,
            font:"BabyDoll.ttf",
        }).centerReg().pos(0,180,CENTER,TOP).alp(0).sca(0).animate({scale:1,alpha:1}, 1.7, "elasticOut",null,null,1);

        const scoreText = new Label({
            text:score,
            size:72,
            backgroundColor:orange,
            corner:10,
            font:"BabyDoll.ttf",
        }).centerReg().pos(0,280,CENTER,TOP).alp(0).sca(0).animate({scale:1,alpha:1}, 1.7, "elasticOut",null,null,2);

        const commentWords = new Label({
            text:comment,
            shadowColor:white,
            labelWidth:800,
            labelHeight:180,
            align:CENTER,
            valign:MIDDLE,
            font:"BabyDoll.ttf",
            splitWords:true
        }).pos(0,180,CENTER,BOTTOM).alp(0).animate({alpha: 1}, 1,null,null,null,3);

        const restart = new Button({
            font:"BabyDoll.ttf",
            width:240, 
            height:60,
            label: "PLAY AGAIN",
            backgroundColor:"#A44B43",
        }).pos(0, 50, CENTER, BOTTOM).alp(0).animate({alpha: 1}, 1).hov().top();

        restart.on("click", () => {
            // window.location.reload();
            winning.removeFrom();
            finalScore.removeFrom();
            scoreText.removeFrom();
            commentWords.removeFrom();
            restart.removeFrom();
            text.removeFrom();
            text2.removeFrom();


            showPart3();
            S.update();
        });
        
        STYLE = {
            font:"BabyDoll.ttf", 
            size:70, 
            color:yellow,
            bold:true,
            letterSpacing:8,
            lineSpacing:50,
            lineAlign:CENTER
        };

        const text = new LabelLetters("meow")
            .centerReg()
            .pos(20,100,LEFT,TOP)
            .sca(0)
            .animate({scale:1}, 3, "elasticOut",null,null,4);

        const colors = series(red,blue,purple,green,pink);

        text.loop(letter=>{
            letter.sha(colors().toAlpha(.5),8,8,0).wiggle("rotation",0,5,10,.2,.4);
        });

        const text2 = new LabelLetters("purr")
            .centerReg()
            .pos(20,120,RIGHT,BOTTOM)
            .sca(0)
            .animate({scale:1}, 3, "elasticOut",null,null,4); 

        text2.loop(letter=>{
            letter.sha(colors().toAlpha(.5),8,8,0).wiggle("rotation",0,5,10,.2,.4);
        });

        STYLE = {};
        }
        
    };//end part4
//-------------------------------------------------------------------------------------
}



</script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body></body>

</html>