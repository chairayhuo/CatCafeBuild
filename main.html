<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>CAT CAFE DEMO</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type=module>

import zim from "https://zimjs.com/cdn/015/zim_game";

const assets = ["BabyDoll.ttf", "blackcat.png", "orangecat.png", "whitecat.png","tuxcat.png","milkdemo.png", "1.png", "2.png","3.png", "4.png", "5.png","6.png"];
const path = "assets/"

// See Docs under Frame for FIT, FILL, FULL, and TAG
new Frame(FIT, 1024, 768, light, dark, ready, assets, path);
function ready() {

//BACKGROUND ELEMENTS-------------------------------------------------------------
const background = new Container(W,H).center();
let score = new Scorer({
    font:"BabyDoll.ttf",
    backgroundColor:orange,
    borderColor: black,
    borderWidth:3,
    width:60}).addTo(background).pos(50,50,RIGHT);

const timer = new Timer({
    font:"BabyDoll.ttf",
    backgroundColor:yellow,
    borderColor: black,
    borderWidth:3,
    width:60}).addTo(background).pos(50,50);

//AUDIO---------------------------------------------------------------------------
S.on("stagemousedown", ()=>{   
        new Aud("backing.mp3").play({volume:.1, loop:true});
    }, null, true);

const flip = new Aud({
        file:"flip.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const close = new Aud({
        file:"close.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const pickup = new Aud({
        file:"pickup.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const meow = new Aud({
        file:"meow.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});
//CATBIBLE------------------------------------------------------------------------
const pages = [
    new Page("1.png"),
    new Page("2.png"),
    new Page("3.png"),
    new Page("4.png"),
    new Page("5.png"),
    new Page("6.png")
];

// Create a Book with the array of Page instances
const catbible = new Book(pages).center().top();

//CATS-----------------------------------------------------------------------------
// let spotA = new Container(200, 200).pos(50, 150, LEFT, TOP).outline();
// let spotB = new Container(200, 200).pos(100, 150, RIGHT, TOP).outline();
// let spotC = new Container(200, 200).center().outline();
// let catCount;

const blackcat = new Pic("blackcat.png").addTo(background).pos(50, 150, LEFT, TOP);
const orangecat = new Pic("orangecat.png").addTo(background).pos(100, 150, RIGHT, TOP);
const whitecat = new Pic("whitecat.png").addTo(background).pos(50, 150, LEFT, BOTTOM);
const tuxcat = new Pic("tuxcat.png").addTo(background).pos(50, 150, RIGHT, BOTTOM);

// let cats = [
//     { cat: blackcat, satisfaction: 0 },
//     { cat: orangecat, satisfaction: 0 },
//     { cat: whitecat, satisfaction: 0 },
//     { cat: tuxcat, satisfaction: 0 },
// ]




// function isSpotEmpty(spot) {
//   return spot.children.length === 0;
// }

//     function pickCats() {
//     const catPicker = pluck(cats);
//     const randomSpot = Math.floor(Math.random() * 3);

//     if (randomSpot === 0 && isSpotEmpty(spotA)) {
//         catPicker.addTo(spotA).scaleTo(spotA).animate({x:200,y:200},1,"backOut");
//         zog("Added cat to spotA");
//     } else if (randomSpot === 1 && isSpotEmpty(spotB)) {
//         catPicker.addTo(spotB).scaleTo(spotB).animate({x:200,y:200},1,"backOut");
//         zog("Added cat to spotB");
//     } else if (randomSpot === 2 && isSpotEmpty(spotC)) {
//         catPicker.addTo(spotC).scaleTo(spotC).animate({x:200,y:200},1,"backOut");
//         zog("Added cat to spotC");
//     } else {
//         zog("All spots are occupied, cannot add cat.");
//     }
//     }

// setInterval(pickCats, interval);

    // ITEMS TO CAT---------------------------------------------------------------------
    let milk;
    let food;
    let toy;
    let brush;


const item1 = new Container(100, 100).pos(100, 100, LEFT, BOTTOM);
const item2 = new Container(100, 100).pos(0, 50, CENTER, BOTTOM);
const item3 = new Container(100, 100).pos(150, 50, RIGHT, BOTTOM);

let cats = [
    { cat: blackcat, satisfaction: 0, accepting: ["milk", "food", "brush"] },
    { cat: orangecat, satisfaction: 0, accepting: ["milk", "food", "brush"] },
    { cat: whitecat, satisfaction: 0, accepting: ["milk", "food", "brush"] },
    { cat: tuxcat, satisfaction: 0, accepting: ["milk", "food", "brush"] }
];

loop(10, () => {
    milk = new Pic("milkdemo.png").addTo(item1).scaleTo(item1).drag();
    food = new Pic("fooddemo.png").addTo(item2).scaleTo(item2).drag();
    brush = new Pic("brushdemo.png").addTo(item3).scaleTo(item3).drag();

    [milk, food, brush].forEach(item => {
        item.startScale = { scaleX: item.scaleX, scaleY: item.scaleY }; 
        item.startPos = { x: item.x, y: item.y }; 
        item.on("pressup", () => {
            checkItem(item);
            pickup.play();
        })
    });
});

function checkItem(item) {
    cats.forEach(catInfo => {
        if (item.hitTestBounds(catInfo.cat) && catInfo.accepting > 0) {
            // If the cat is accepting the item, increase satisfaction and update accepting count
            catInfo.satisfaction++;
            catInfo.accepting--;

            // Dispose of the item
            item.dispose();

            zog(`Cat Satisfaction: ${catInfo.satisfaction}`);
            zog(`Cat Accepting: ${catInfo.accepting}`);

            // Check if the cat has reached maximum satisfaction
            if (catInfo.satisfaction >= 3) {
                animateCatOffScreen(catInfo.cat);
                score.score++;
            zog(`Score: ${score}`);
            }
        } else {
            // If the cat is not accepting the item, snap it back to the start position
            item.animate({ x: item.startPos.x, y: item.startPos.y }, 0.3);
        }
    });
}

//animate in two parts, first jump then move off screen 
function animateCatOffScreen(cat) {
    meow.play();
    cat.animate({
        props:[
            {props:{y:cat.y-20},time:.5, ease: "bounceIn"},
            {props:{y:cat.y+20},time:.7, ease: "bounceOut"},
            {props:{x:-500, y:50}, time: 5, ease:"backOut"}
        ]
    // cat.animate({x:-500, y:50}, 5, "backOut")
    });
};


setInterval(() => {
    cats.forEach(catInfo => {
        catInfo.accepting = 3; 
    });
}, 5); 

}
</script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body></body>

</html>