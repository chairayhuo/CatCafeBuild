<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>CAT CAFE DEMO</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type=module>

import zim from "https://zimjs.com/cdn/015/zim_game";

const assets = ["BabyDoll.ttf", "blackcat.png", "orangecat.png", "whitecat.png","tuxcat.png","milkdemo.png", "0.png","1.png", "2.png","3.png", "4.png", "5.png"];
const path = "assets/"

// See Docs under Frame for FIT, FILL, FULL, and TAG
new Frame(FIT, 1024, 768, light, dark, ready, assets, path);
function ready() {

//BACKGROUND ELEMENTS-------------------------------------------------------------
const background = new Pic("background.png").sca(.85).center();

let score = new Scorer({
    font:"BabyDoll.ttf",
    backgroundColor:orange,
    borderColor: black,
    borderWidth:3,
    width:60}).pos(50,50,RIGHT);

const timer = new Timer({
    font:"BabyDoll.ttf",
    backgroundColor:yellow,
    borderColor: black,
    borderWidth:3,
    width:60}).pos(50,50);


    //ADD IN START IMAGE 

    S.on("stagemousedown", ()=>{              
    timer.start();    
    }, null, true); 

S.update();
//AUDIO---------------------------------------------------------------------------
S.on("stagemousedown", ()=>{   
        new Aud("backing.mp3").play({volume:.1, loop:true});
    }, null, true);

const flip = new Aud({
        file:"flip.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const close = new Aud({
        file:"close.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const pickup = new Aud({
        file:"pickup.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const meow = new Aud({
        file:"meow.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});

const angry = new Aud({
        file:"angry.mp3",
        volume:.1,
        interrupt:"none",
        maxNum:1
});
//CATBIBLE------------------------------------------------------------------------
let closeBook;

const page1 = new Page({color: "#EFE2CF"});
page1.content = new Pic("0.png").addTo(page1).pos(-10,0,CENTER,LEFT,page1);

const page2 = new Page({color: "#EFE2CF"});
page2.content = new Pic("1.png").addTo(page2).pos(340,0,CENTER,RIGHT, page1);

const page3 = new Page({color: "#EFE2CF"});
page3.content = new Pic("2.png").addTo(page3).pos(-10,0,CENTER,LEFT,page3);

const page4 = new Page({color: "#EFE2CF"});
page4.content = new Pic("3.png").addTo(page4).pos(340,0,CENTER,RIGHT, page3);

const page5 = new Page({color: "#EFE2CF"});
page5.content = new Pic("4.png").addTo(page5).pos(-10,0,CENTER,LEFT,page5);

const page6 = new Page({color: "#EFE2CF"});
page6.content = new Pic("5.png").addTo(page6).pos(340,0,CENTER,RIGHT, page5);

const pages = [page1, page2, page3, page4, page5];

const book = new Book(700, 500, pages)

const bookCont = new Container(70,70).pos(150,50,RIGHT, TOP);
const catbible = new Pic("catbible.png").addTo(bookCont).scaleTo(bookCont).hov(1)   
    .tap(()=>{
        flip.play();
        book.center().addTo(S);
        closeBook = new Button(40,38,"x",red).pos(170,145, RIGHT, TOP);
        closeBook.tap(()=>{
            if (S.contains(book)) {
                close.play()
                book.removeFrom(S);
                closeBook.removeFrom()
            }
        });
    });

//CATS-----------------------------------------------------------------------------
const blackcat = new Pic("blackcat.png").addTo(background).pos(50, 150, LEFT, TOP);
const orangecat = new Pic("orangecat.png").addTo(background).pos(100, 150, RIGHT, TOP);
const whitecat = new Pic("whitecat.png").addTo(background).pos(50, 150, LEFT, BOTTOM);
const tuxcat = new Pic("tuxcat.png").addTo(background).pos(50, 150, RIGHT, BOTTOM);

//CAT TIMER-----------------------------------------------------------------------------

let blackTimer = new Timer({
        time: 15,
        font:"BabyDoll.ttf",
        backgroundColor:white,
        borderColor: black,
        borderWidth:3,
        width:60}).addTo(blackcat).pos(130,15);

    let orangeTimer = new Timer({
        time: 15,
        font:"BabyDoll.ttf",
        backgroundColor:white,
        borderColor: black,
        borderWidth:3,
        width:60}).addTo(orangecat).pos(135,-10);

    let whiteTimer = new Timer({
        time: 10,
        font:"BabyDoll.ttf",
        backgroundColor:white,
        borderColor: black,
        borderWidth:3,
        width:60}).addTo(whitecat).pos(135,10);

    let tuxTimer = new Timer({
        time: 8,
        font:"BabyDoll.ttf",
        backgroundColor:white,
        borderColor: black,
        borderWidth:3,
        width:60}).addTo(tuxcat).pos(135,5);

        let catTimers = [blackTimer, orangeTimer, whiteTimer,tuxTimer];

//ITEMS TO CAT---------------------------------------------------------------------

    let milk;
    let food;
    let toy;
    let brush;


const item1 = new Container(100, 100).pos(100, 100, LEFT, BOTTOM);
const item2 = new Container(100, 100).pos(0, 50, CENTER, BOTTOM);
const item3 = new Container(100, 100).pos(150, 50, RIGHT, BOTTOM);

let cats = [
    { cat: blackcat, satisfaction: 0, accepting: ["milk", "food", "brush"], catTimers:blackTimer },
    { cat: orangecat, satisfaction: 0, accepting: ["milk", "food", "brush"], catTimers:orangeTimer},
    { cat: whitecat, satisfaction: 0, accepting: ["milk", "food", "brush"], catTimers:whiteTimer},
    { cat: tuxcat, satisfaction: 0, accepting: ["milk", "food", "brush"],catTimers:tuxTimer }
];

loop(10, () => {
    milk = new Pic("milkdemo.png").addTo(item1).scaleTo(item1).drag();
    food = new Pic("fooddemo.png").addTo(item2).scaleTo(item2).drag();
    brush = new Pic("brushdemo.png").addTo(item3).scaleTo(item3).drag();

    [milk, food, brush].forEach(item => {
        item.startScale = { scaleX: item.scaleX, scaleY: item.scaleY }; 
        item.startPos = { x: item.x, y: item.y }; 
        item.on("pressup", () => {
            checkItem(item);
            pickup.play();
        })
    });
});

function checkItem(item) {
    cats.forEach(catInfo => {
        if (item.hitTestBounds(catInfo.cat) && catInfo.accepting > 0) {
            
            catInfo.satisfaction++;
            catInfo.accepting--;


            item.dispose();

            zog(`Cat Satisfaction: ${catInfo.satisfaction}`);
            zog(`Cat Accepting: ${catInfo.accepting}`);

      
            if (catInfo.satisfaction >= 3) {
                catInfo.catTimers.dispose();
                //added a dispose
                animateCatOffScreen(catInfo.cat);
                score.score++;
            zog(`Score: ${score}`);
            }
        } else {
            // If the cat is not accepting the item, snap it back to the start position
            item.animate({ x: item.startPos.x, y: item.startPos.y }, 0.3);
        }
    });
}


setInterval(() => {
    cats.forEach(catInfo => {
        catInfo.accepting = 3; 
    });
}, 5); 

//CAT REACTIONS--------------------------------------------------------------------
function updateTimer() {
    for (let i = 0; i < catTimers.length; i++) {
        let timer = catTimers[i];
        if (timer.time <= 3) {
            timer.backgroundColor = "red";
        } else if (timer.time <= 7) {
            timer.backgroundColor = "orange";
        } else {
            timer.backgroundColor = white;
        }
        if (timer.time <= 0) {
            animateCatMad(cats[i].cat);
            timer.dispose();
        }
    }
}

Ticker.add(updateTimer, 1);

//HAPPY CAT
function animateCatOffScreen(cat) {
    if (!cat.animated) {
        cat.animated = true; 
    meow.play();
    cat.animate({
        props:[
            {props:{y:cat.y-20},time:.5, ease: "bounceIn"},
            {props:{y:cat.y+20},time:.7, ease: "bounceOut"},
            {props:{x:-500, y:50}, time: 5, ease:"backOut"}
        ],
        });
    };
};


//MAD CAT
function animateCatMad(cat) {
    if (!cat.animated) {
        cat.animated = true; 
        angry.play();
        cat.animate({
            props:{x:-500, y:50}, 
            time: 5, 
            ease:"backOut",
        })
    }
}









}


</script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body></body>

</html>